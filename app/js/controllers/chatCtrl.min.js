ChatApp.controller("chatCtrl",["$scope","$rootScope","$http","$state","$sessionStorage","$stateParams","$interval","$timeout","$mdToast","$anchorScroll","CONFIG",function(e,t,s,a,o,n,r,c,i,g,h){e.getUserData("chat"),e.messageData={message:"",fromUser:n.fromUserId,toUser:n.toUserId,senderName:o.userData.name,recieverName:o.recieverData.name,postedDate:new Date},e.getChatList=function(t){"get"!=t&&(e.loading=!0);var a={fromUser:n.fromUserId,toUser:n.toUserId};s({method:"POST",url:h.rootUrl+"getChatList",headers:{"Content-Type":"application/json"},data:a}).then(function(t){if(e.loading=!1,1==t.data.success){if(t.data.chats.length>0){e.chatList=t.data.chats;var s=e.chatList.length-1,a=e.chatList[s];console.log("msgId",a),g(a.id),console.log("chatList",e.chatList)}}else e.msgContent="You have'nt sent any message to this person yet.",e.toasterClass="warningClass",e.showAlertMessage();console.log("innerHeight",window.innerHeight)})},e.getChatList(),e.sendMessage=function(t){s({method:"POST",url:h.rootUrl+"senMessage",headers:{"Content-Type":"application/json"},data:e.messageData}).then(function(t){console.log("response",t),1==t.data.success&&(e.messageData.message="")})},e.connectChatWs=function(){userMessages=new WebSocket(h.chatUrl);var t={fromUserId:n.fromUserId,toUserId:n.toUserId},s=JSON.stringify(t);userMessages.onopen=function(){userMessages.send(s)},userMessages.onmessage=function(t){var s=t.data,a=JSON.parse(s);e.chatList.push(a);var o=e.chatList.length-1,n=e.chatList[o];g(n.msgId)},userMessages.onerror=function(e){},userMessages.onclose=function(){e.connectChatWs()}},c(function(){e.connectChatWs()},800),e.showAlertMessage=function(){i.show(i.simple().textContent(e.msgContent).position("top left").hideDelay(3e3).toastClass(e.toasterClass))},t.$on("$stateChangeStart",function(t,s,a,o,n){e.pageChanged=!0,r.cancel(e.getData)})}]);